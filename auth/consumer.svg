<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="879px" preserveAspectRatio="none" style="width:1138px;height:879px;" version="1.1" viewBox="0 0 1138 879" width="1138px" zoomAndPan="magnify"><defs><filter height="300%" id="fj9ughe26oy9e" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fj9ughe26oy9e)" height="230.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="636.5" y="191.6953"/><rect fill="#FFFFFF" filter="url(#fj9ughe26oy9e)" height="325.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="636.5" y="538.3594"/><rect fill="#FFFFFF" filter="url(#fj9ughe26oy9e)" height="369.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="976.5" y="494.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="218" x2="218" y1="88.2969" y2="127.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="218" x2="218" y1="127.4297" y2="155.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="218" x2="218" y1="155.4297" y2="429.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="218" x2="218" y1="429.8281" y2="457.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="218" x2="218" y1="457.8281" y2="872.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="448.5" y1="88.2969" y2="127.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="448.5" x2="448.5" y1="127.4297" y2="155.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="448.5" y1="155.4297" y2="429.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="448.5" x2="448.5" y1="429.8281" y2="457.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="448.5" y1="457.8281" y2="872.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="641.5" x2="641.5" y1="88.2969" y2="127.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="641.5" x2="641.5" y1="127.4297" y2="155.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="641.5" x2="641.5" y1="155.4297" y2="429.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="641.5" x2="641.5" y1="429.8281" y2="457.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="641.5" x2="641.5" y1="457.8281" y2="872.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="981" x2="981" y1="88.2969" y2="127.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="981" x2="981" y1="127.4297" y2="155.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="981" x2="981" y1="155.4297" y2="429.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="981" x2="981" y1="429.8281" y2="457.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="981" x2="981" y1="457.8281" y2="872.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="179" y="84.9951">Consumer</text><ellipse cx="218" cy="15" fill="#FEFECE" filter="url(#fj9ughe26oy9e)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M218,23 L218,50 M205,31 L231,31 M218,50 L205,65 M218,50 L231,65 " fill="none" filter="url(#fj9ughe26oy9e)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fj9ughe26oy9e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="189" x="352.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="175" x="359.5" y="72.9951">DataSetu Catalog server</text><rect fill="#FEFECE" filter="url(#fj9ughe26oy9e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="555.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="562.5" y="72.9951">DataSetu Auth server</text><rect fill="#FEFECE" filter="url(#fj9ughe26oy9e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="915" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="922" y="72.9951">Resource server</text><rect fill="#FFFFFF" filter="url(#fj9ughe26oy9e)" height="230.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="636.5" y="191.6953"/><rect fill="#FFFFFF" filter="url(#fj9ughe26oy9e)" height="325.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="636.5" y="538.3594"/><rect fill="#FFFFFF" filter="url(#fj9ughe26oy9e)" height="369.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="976.5" y="494.0938"/><polygon fill="#0000FF" points="437,115.4297,447,119.4297,437,123.4297,441,119.4297" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="218" x2="443" y1="119.4297" y2="119.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="225" y="114.3638">[1]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="250" y="114.3638">Search catalog for data-sets</text><polygon fill="#008000" points="624.5,187.6953,634.5,191.6953,624.5,195.6953,628.5,191.6953" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="218" x2="630.5" y1="191.6953" y2="191.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="225" y="179.063">[2]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="250" y="171.4966">HTTPS POST /auth/v1/token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="337" x="250" y="186.6294">body={"request" : list of resource IDs from catalog}</text><path d="M5,162.9961 L5,187.9961 L209,187.9961 L209,172.9961 L199,162.9961 L5,162.9961 " fill="#FBFB77" filter="url(#fj9ughe26oy9e)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M199,162.9961 L199,172.9961 L209,172.9961 L199,162.9961 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="11" y="180.063">Request for an access token</text><line style="stroke: #FF0000; stroke-width: 1.0;" x1="646.5" x2="688.5" y1="220.8281" y2="220.8281"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="688.5" x2="688.5" y1="220.8281" y2="233.8281"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="647.5" x2="688.5" y1="233.8281" y2="233.8281"/><polygon fill="#FF0000" points="657.5,229.8281,647.5,233.8281,657.5,237.8281,653.5,233.8281" style="stroke: #FF0000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="20" x="653.5" y="215.7622">[3]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="677.5" y="215.7622">Check data provider's access control policies</text><polygon fill="#008000" points="229,283.0938,219,287.0938,229,291.0938,225,287.0938" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="223" x2="635.5" y1="287.0938" y2="287.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="235" y="282.0278">[4]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="260" y="282.0278">HTTP 403 Forbidden</text><polygon fill="#008000" points="229,417.8281,219,421.8281,229,425.8281,225,421.8281" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="223" x2="640.5" y1="421.8281" y2="421.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="235" y="371.3638">[5]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="264" y="325.9653"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="260" y="341.0981">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="260" y="356.231">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="292" y="371.3638">token:&lt;token&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="292" y="386.4966">token-type:DATASETU</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="292" y="401.6294">expires-in:&lt;expiry-in-seconds&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="260" y="416.7622">}</text><path d="M56,355.2969 L56,380.2969 L209,380.2969 L209,365.2969 L199,355.2969 L56,355.2969 " fill="#FBFB77" filter="url(#fj9ughe26oy9e)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M199,355.2969 L199,365.2969 L209,365.2969 L199,355.2969 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="62" y="372.3638">Token and its details</text><polygon fill="#0000FF" points="964.5,490.0938,974.5,494.0938,964.5,498.0938,968.5,494.0938" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="218" x2="970.5" y1="494.0938" y2="494.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="225" y="481.4614">[6]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="250" y="473.895">HTTPS GET &lt;resource-server-api&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="250" y="489.0278">Authorization: DATASETU &lt;token&gt;</text><polygon fill="#008000" points="657.5,534.3594,647.5,538.3594,657.5,542.3594,653.5,538.3594" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="651.5" x2="975.5" y1="538.3594" y2="538.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="663.5" y="525.7271">[7]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="688.5" y="518.1606">HTTPS POST /auth/v1/token/introspect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="688.5" y="533.2935">body={"token": &lt;token&gt;}</text><path d="M991,509.6602 L991,534.6602 L1129,534.6602 L1129,519.6602 L1119,509.6602 L991,509.6602 " fill="#FBFB77" filter="url(#fj9ughe26oy9e)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1119,509.6602 L1119,519.6602 L1129,519.6602 L1119,509.6602 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="997" y="526.7271">Validate the token</text><line style="stroke: #FF0000; stroke-width: 1.0;" x1="646.5" x2="688.5" y1="567.4922" y2="567.4922"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="688.5" x2="688.5" y1="567.4922" y2="580.4922"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="647.5" x2="688.5" y1="580.4922" y2="580.4922"/><polygon fill="#FF0000" points="657.5,576.4922,647.5,580.4922,657.5,584.4922,653.5,580.4922" style="stroke: #FF0000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="653.5" y="562.4263">[8]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="291" x="678.5" y="562.4263">Verify resource-server's identity through DNS</text><line style="stroke: #FF0000; stroke-width: 1.0;" x1="646.5" x2="688.5" y1="609.625" y2="609.625"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="688.5" x2="688.5" y1="609.625" y2="622.625"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="647.5" x2="688.5" y1="622.625" y2="622.625"/><polygon fill="#FF0000" points="657.5,618.625,647.5,622.625,657.5,626.625,653.5,622.625" style="stroke: #FF0000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="653.5" y="604.5591">[9]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="678.5" y="604.5591">Check token validity</text><polygon fill="#008000" points="964.5,762.6875,974.5,766.6875,964.5,770.6875,968.5,766.6875" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="646.5" x2="970.5" y1="766.6875" y2="766.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="653.5" y="716.2231">[10]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="688.5" y="670.8247">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="688.5" y="685.9575">body = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="720.5" y="701.0903">"consumer":&lt;consumer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="720.5" y="716.2231">"consumer-certificate-class":&lt;class&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="720.5" y="731.356">"expiry":&lt;expiry-time&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="720.5" y="746.4888">"request":&lt;request&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="688.5" y="761.6216">}</text><polygon fill="#0000FF" points="229,806.9531,219,810.9531,229,814.9531,225,810.9531" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="223" x2="975.5" y1="810.9531" y2="810.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="235" y="798.3208">[11]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="269" y="790.7544">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="269" y="805.8872">body=&lt;requested-data&gt;</text><polygon fill="#008000" points="964.5,850.8906,974.5,854.8906,964.5,858.8906,968.5,854.8906" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="646.5" x2="970.5" y1="854.8906" y2="854.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="653.5" y="849.8247">[12]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="687.5" y="849.8247">HTTP 403 Forbidden</text><!--MD5=[022de4041d93d76a6527f9e9bd5597b2]
@startuml
hide footbox

autonumber "<b>[0]"

actor "Consumer" as c


participant "DataSetu Catalog server" as catalog

participant "DataSetu Auth server" as auth
participant "Resource server" as rs

c -[#blue]> catalog : Search catalog for data-sets
...

c -[#green]> auth : HTTPS POST /auth/v1/token\nbody={"request" : list of resource IDs from catalog}
note left: Request for an access token

activate auth
auth -[#red]> auth : Check data provider's access control policies

alt Consumer is NOT authorized
    auth -[#green]> c : HTTP 403 Forbidden
    
else Consumer is authorized 

    auth -[#green]> c : \nHTTP 200 OK\n{\n\ttoken:<token>\n\ttoken-type:DATASETU\n\texpires-in:<expiry-in-seconds>\n}
    note left: Token and its details
    deactivate auth

    ...
    
    c -[#blue]> rs : HTTPS GET <resource-server-api>\nAuthorization: DATASETU <token>
    activate rs
    rs -[#green]> auth : HTTPS POST /auth/v1/token/introspect\nbody={"token": <token>}
    note right: Validate the token
    activate auth
    
    auth -[#red]> auth: Verify resource-server's identity through DNS

    auth -[#red]> auth: Check token validity

    alt <access-token> is valid
        auth -[#green]> rs : HTTP 200 OK\nbody = {\n\t"consumer":<consumer>,\n\t"consumer-certificate-class":<class>\n\t"expiry":<expiry-time>,\n\t"request":<request>\n}

        rs -[#blue]> c : HTTP 200 OK\nbody=<requested-data>
        
    else Invalid <access-token>
        auth -[#green]> rs: HTTP 403 Forbidden
@enduml

PlantUML version 1.2020.18(Wed Sep 30 19:40:44 UTC 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>